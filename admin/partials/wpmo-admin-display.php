<?php

/**
 * Provide a admin area view for the plugin
 *
 * This file is used to markup the admin-facing aspects of the plugin.
 *
 * @link       https://wpmastery.xyz
 * @since      1.0.0
 *
 * @package    Wpmo
 * @subpackage Wpmo/admin/partials
 */
wp_nonce_field( 'wpmo-trigger-cancelled-subscription-export', 'wpmo_export_nonce' );
$missing_annuals               = array(
	26847,
	26836,
	26787,
	26601,
	26576,
	26560,
	26549,
	26536,
	26523,
	26496,
	26470,
	26423,
	26332,
	26320,
	26289,
	26273,
	26253,
	26240,
	26223,
	26130,
	26063,
	26035,
	25974,
	25962,
	25949,
	25933,
	25886,
	25798,
	25764,
	25610,
	25581,
	25513,
	25479,
	25448,
	25425,
	25403,
	25392,
	25376,
	25343,
	25327,
	25268,
	25235,
	25219,
	25023,
	24887,
	24876,
	24865,
	24801,
	24766,
	24755,
	24744,
	24726,
	24651,
	24620,
	24599,
	24574,
	24562,
	24541,
	24525,
	24502,
	24491,
	24480,
	24449,
	24439,
	24385,
	24320,
	24308,
	24282,
	24209,
	24198,
	24181,
	24170,
	24148,
	24093,
	24061,
	24050,
	23994,
	23893,
	23875,
	23855,
	23822,
	23806,
	23784,
	23773,
	23757,
	23736,
	23704,
	23693,
	23629,
	23608,
	23592,
	23577,
	23532,
	23516,
	23469,
	23450,
	23439,
	23392,
	23376,
	23365,
	23340,
	23318,
	23307,
	23296,
	23241,
	23204,
	23184,
	23140,
	23101,
	23090,
	23069,
	23053,
	22973,
	22940,
	22921,
	22905,
	22887,
	22876,
	22858,
	22831,
	22801,
	22774,
	22680,
	22664,
	22653,
	22608,
	22590,
	22558,
	22486,
	22469,
	22439,
	22397,
	22371,
	22341,
	22310,
	22160,
	22112,
	22090,
	22074,
	22057,
	22009,
	21985,
	21950,
	21917,
	21871,
	21789,
	21777,
	21761,
	21726,
	21715,
	21688,
	21651,
	21534,
	21505,
	21432,
	21416,
	21394,
	21376,
	21353,
	21333,
	21322,
	21224,
	21187,
	21158,
	21146,
	21120,
	21101,
	21019,
	21001,
	20964,
	20945,
	20912,
	20893,
	20882,
	20863,
	20852,
	20806,
	20775,
	20764,
	20748,
	20737,
	20720,
	20704,
	20676,
	20656,
	20585,
	20572,
	20561,
	20550,
	20537,
	20410,
	20395,
	20379,
	20338,
	19174,
	19141,
	19126,
	19078,
	19059,
	19048,
	19013,
	18998,
	18962,
	18932,
	18908,
	18866,
	18836,
	18824,
	18783,
	18771,
	18748,
	18729,
	18713,
	18689,
	18672,
	18638,
	18618,
	18593,
	18570,
	18479,
	18423,
	18399,
	18386,
	18374,
	18348,
	18331,
	18318,
	18306,
	18235,
	18198,
	18175,
	18164,
	18152,
	18135,
	18114,
	18093,
	18069,
	18030,
	18014,
	17973,
	17962,
	17944,
	17933,
	17880,
	17846,
	17805,
	17771,
	17758,
	17740,
	17726,
	17681,
	17670,
	17638,
	17576,
	17560,
	17537,
	17520,
	17508,
	17495,
	17480,
	17469,
	17430,
	17419,
	17394,
	17347,
	17336,
	17321,
	17304,
	17265,
	17244,
	17073,
	17050,
	17039,
	17022,
	17011,
	16972,
	16961,
	16935,
	16906,
	16857,
	16834,
	16722,
	16706,
	16642,
	16615,
	16572,
	16550,
	16539,
	16503,
	16480,
	16463,
	16449,
	16397,
	15920,
	15908,
	15895,
	15871,
	15855,
	15828,
	15821,
	15804,
	15792,
	15756,
	15745,
	15730,
	15719,
	15667,
	15645,
	15634,
	15623,
	15566,
	15529,
	15518,
	15507,
	15500,
	15485,
	15474,
	15459,
	15448,
	15433,
	15421,
	15414,
	15386,
	15379,
	15372,
	15360,
	15331,
	15317,
	15302,
	15284,
	15246,
	15236,
	15229,
	15207,
	15191,
	15112,
	15094,
	15044,
	15024,
	14982,
	14973,
	14960,
	14928,
	14921,
	14914,
	14850,
	14835,
	14722,
	14715,
	14668,
	14624,
	14606,
	14572,
	13936,
	13725,
);
$forbidden_order_status        = array(
	'wc-refunded',
	'wc-cancelled',
	'wc-failed',
	'wc-on-hold',
);
$forbidden_subscription_status = array(
	'wc-on-hold',
	'wc-cancelled',
	'trash',
	'wc-pending-cancel',
	'wc-pending',
);
foreach ( $missing_annuals as $order_id ) {
	// $subscription_id = wpm_get_subscription_id_from_order( $order_id );
	if (
		$order_id &&
		! in_array( get_post_status( $order_id ), $forbidden_order_status, true ) &&
		! in_array( get_post_status( $order_id ), $forbidden_subscription_status, true )
	) {
		wpm_fix_renewal_date( $order_id );
		update_post_meta( $order_id, '_billing_interval', 1 );
		update_post_meta( $order_id, '_billing_period', 'year' );
		update_post_meta( $order_id, '_wpm_current_season', 'summer' );
		wpmastery_write_log( "Fixed subscription: $order_id" );
	}
}
?>
<p>Click the button below to trigger the export of the cancelled and pending-cancellation subscriptions.</p>
<button id='wpmo-trigger-cancelled-subscription-export' class="button button-primary">Start export</button>
<span id='wpmo-running'>Please wait. Export is running.</span>
<div id='wpmo-success-notice'>
	<p>Success. <a href='<?php echo esc_url( get_site_url() ); ?>/wp-content/uploads/cancelled-subscriptions.csv'>Download export file here.</a></p>
</div>
<div id="wpmo-error-notice">
	<p></p>
</div>
